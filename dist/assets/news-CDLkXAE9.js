import"./metrika-BY1HYfmI.js";/* empty css             */import"./discount-popup-C8REf4fq.js";import"./news-data-DPVDa9uH.js";class o{constructor(){this.newsData=[],this.filteredNews=[],this.currentPage=1,this.itemsPerPage=12,this.currentCategory="all",this.currentSort="date",this.init()}init(){this.loadNewsData(),this.setupEventListeners(),this.renderNews()}async loadNewsData(){try{const t=await fetch("/api/posts");if(!t.ok)throw new Error("Failed to fetch news");const s=await t.json();this.newsData=s.map(e=>{const n=e.datePublished||e.dateCreated;return{id:e.id,title:e.title,rawDate:n,date:new Date(n).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}),type:e.type==="NEWS"?"news":"article",category:e.category==="NEWS"?"news":"articles",content:e.content,image:e.image||null,views:e.views,tags:e.tags||[],slug:e.slug}}),this.applyFilters()}catch{}}setupEventListeners(){const t=document.getElementById("sortToggle"),s=document.getElementById("sortMenu");t&&s&&(t.addEventListener("click",r=>{r.stopPropagation(),s.classList.toggle("active")}),s.addEventListener("click",r=>{r.target.classList.contains("filter-dropdown__option")&&(this.currentSort=r.target.dataset.value,this.updateSortText(r.target.textContent),s.classList.remove("active"),this.applyFilters())}));const e=document.getElementById("categoryToggle"),n=document.getElementById("categoryMenu");e&&n&&(e.addEventListener("click",r=>{r.stopPropagation(),n.classList.toggle("active")}),n.addEventListener("click",r=>{r.target.classList.contains("filter-dropdown__option")&&(this.currentCategory=r.target.dataset.value,this.updateCategoryText(r.target.textContent),n.classList.remove("active"),this.applyFilters())}));const i=document.getElementById("showMoreBtn");i&&i.addEventListener("click",()=>{this.loadMoreNews()}),document.addEventListener("click",r=>{r.target.closest(".filter-dropdown")||document.querySelectorAll(".filter-dropdown__menu.active").forEach(a=>{a.classList.remove("active")})})}updateSortText(t){const s=document.getElementById("sortToggle");if(s){const e=s.querySelector(".filter-dropdown__text");e&&(e.textContent=t)}}updateCategoryText(t){const s=document.getElementById("categoryToggle");if(s){const e=s.querySelector(".filter-dropdown__text");e&&(e.textContent=t)}}applyFilters(){this.currentPage=1,this.currentCategory==="all"?this.filteredNews=[...this.newsData]:this.filteredNews=this.newsData.filter(t=>this.currentCategory==="news"?t.type==="news":this.currentCategory==="articles"?t.type==="article"&&t.category==="articles":this.currentCategory==="actions"?t.type==="article"&&t.category==="actions":!0),this.sortNews(),this.renderNews()}sortNews(){this.filteredNews.sort((t,s)=>{switch(this.currentSort){case"date":return new Date(s.rawDate)-new Date(t.rawDate);case"popular":return(s.views||0)-(t.views||0);case"title":return t.title.localeCompare(s.title,"ru");default:return 0}})}renderNews(){const t=document.getElementById("newsGrid");if(!t)return;const s=0,e=this.currentPage*this.itemsPerPage,n=this.filteredNews.slice(s,e);if(t.innerHTML="",n.length===0){t.innerHTML='<div class="no-news">Новости не найдены</div>';return}n.forEach(r=>{const a=this.createNewsCard(r);t.appendChild(a)});const i=document.getElementById("showMoreBtn");i&&(e<this.filteredNews.length?i.style.display="flex":i.style.display="none")}createNewsCard(t){const s=document.createElement("div");s.className=`news-card news-card--${t.type}`,s.setAttribute("data-id",t.id);let e="";if(t.type==="news"&&t.image)e=`
                <div class="news-card__image">
                    <img src="${t.image}" alt="${t.title}">
                </div>
                <div class="news-card__content">
                    <div class="news-card__date">${t.date}</div>
                    <h3 class="news-card__title">${t.title}</h3>
                    <div class="news-card__tags">
                        ${t.tags.map(n=>`<span class="news-tag">${n}</span>`).join("")}
                    </div>
                </div>
            `;else{const n=this.truncateTextByLines(t.content,4);e=`
                <div class="news-card__content">
                    <div class="news-card__date">${t.date}</div>
                    <h3 class="news-card__title">${t.title}</h3>
                    <p class="news-card__description">${n}</p>
                    <div class="news-card__tags">
                        ${t.tags.map(i=>`<span class="news-tag">${i}</span>`).join("")}
                    </div>
                </div>
            `}return s.innerHTML=e,s.addEventListener("click",()=>{this.openNewsDetail(t.slug)}),s}truncateTextByLines(t,s){if(!t)return"";const e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.height="auto",e.style.width="280px",e.style.lineHeight="1.25",e.style.fontSize="18px",e.style.fontFamily="Inter, sans-serif",e.style.wordWrap="break-word",document.body.appendChild(e);let n="";const i=t.trim().split(" ");for(let r=0;r<i.length;r++)if(e.textContent=i.slice(0,r+1).join(" ")+"...",Math.round(e.scrollHeight/(parseInt(e.style.lineHeight)*parseInt(e.style.fontSize)))>s){n=i.slice(0,r).join(" ")+"...";break}return n||(n=t),document.body.removeChild(e),n}loadMoreNews(){this.currentPage++,this.renderNews()}openNewsDetail(t){window.location.href=`news-detail.html?slug=${t}`}}document.addEventListener("DOMContentLoaded",()=>{new o});
