import"./metrika-BY1HYfmI.js";import"./discount-popup-C8REf4fq.js";document.addEventListener("DOMContentLoaded",function(){const D=document.querySelector(".contacts__form"),S=document.querySelectorAll(".main-option"),C=document.querySelectorAll(".additional-option"),o=document.querySelector(".contacts__submit"),r=document.getElementById("contactName"),i=document.getElementById("contactPhone"),l=document.getElementById("contactCar"),v=document.getElementById("contactNameError"),p=document.getElementById("contactPhoneError"),f=document.getElementById("contactCarError"),E=document.getElementById("discountSection"),I=document.getElementById("discountPercent"),d=document.getElementById("successPopupOverlay"),P=document.getElementById("successPopupClose"),_=document.getElementById("contactsSuccessBtn");let u="",c=[],h={name:"",phone:"",carModel:"",mainService:"",additionalServices:[],discount:0,timestamp:""};const $=/^(\+7|7|8)?[\s\-]?\(?[0-9]{3}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/,O={"antigravity-film":5e4,"disk-painting":3e4,cleaning:15e3,ceramic:25e3,polish:1e4};function M(){if(c.length===0)return 0;const t=Math.min([0,2,4,8,12,16,20][c.length]||20,20);let n=0;c.forEach(b=>{n+=O[b]||0});const m=Math.floor(n/1e4)*.5,y=Math.min(t+m,20);return Math.round(y)}function L(){const e=M();e>0?(I.textContent=`-${e}%`,E.style.display="flex"):E.style.display="none",h.discount=e}function B(){return r.value.trim().length<2?(v.textContent="Имя должно содержать минимум 2 символа",v.classList.add("active"),!1):(v.classList.remove("active"),!0)}function k(){const e=i.value.trim();return $.test(e)?(p.classList.remove("active"),!0):(p.textContent="Введите корректный номер телефона",p.classList.add("active"),!1)}function x(){return l.value.trim().length<3?(f.textContent="Укажите марку и модель автомобиля",f.classList.add("active"),!1):(f.classList.remove("active"),!0)}function a(){const e=u!=="",t=r.value.trim()&&i.value.trim()&&l.value.trim();o.disabled=!(e&&t)}S.forEach(e=>{e.addEventListener("click",function(){S.forEach(t=>t.classList.remove("main-option--active")),this.classList.add("main-option--active"),u=this.dataset.service,a(),L()})}),C.forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.option;c.includes(t)?(c=c.filter(n=>n!==t),this.classList.remove("additional-option--selected")):(c.push(t),this.classList.add("additional-option--selected")),L()})}),r.addEventListener("input",function(){B(),a()}),i.addEventListener("input",function(){k(),a()}),l.addEventListener("input",function(){x(),a()}),i.addEventListener("input",function(e){let t=e.target.value.replace(/\D/g,"");t.length>11&&(t=t.slice(0,11)),t.length>=6?t=t.replace(/(\d{1})(\d{3})(\d{3})(\d{2})(\d{2})/,"+$1 ($2) $3-$4-$5"):t.length>=3?t=t.replace(/(\d{1})(\d{3})/,"+$1 ($2"):t.length>=1&&(t="+"+t),e.target.value=t,k(),a()}),D.addEventListener("submit",function(e){e.preventDefault();const t=B(),n=k(),m=x();!t||!n||!m||!(u!=="")||(o.classList.add("loading"),o.textContent="Отправляем...",o.disabled=!0,h={name:r.value.trim(),phone:i.value.trim(),carModel:l.value.trim(),mainService:u,additionalServices:[...c],discount:M(),timestamp:new Date().toISOString()},T(h),setTimeout(()=>{q(),o.classList.remove("loading"),o.textContent="Отправить заявку"},1500))});function q(){d.classList.add("active"),document.body.style.overflow="hidden"}function w(){r.value="",i.value="",l.value="",u="",c=[],S.forEach(e=>e.classList.remove("main-option--active")),C.forEach(e=>e.classList.remove("additional-option--selected")),E.style.display="none",v.classList.remove("active"),p.classList.remove("active"),f.classList.remove("active"),o.disabled=!0,h={name:"",phone:"",carModel:"",mainService:"",additionalServices:[],discount:0,timestamp:""}}function g(){d.classList.remove("active"),document.body.style.overflow="",w()}P.addEventListener("click",g),_.addEventListener("click",g),d.addEventListener("click",function(e){e.target===d&&g()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&d.classList.contains("active")&&g()});function T(e){const t="https://app.sbercrm.com/react-gateway/api/webhook/9c5fc3c2-1761-43a8-980a-21c18f85476e",n={carbon:"karbon",antichrome:"antikhrom"},m={ceramic:"keramika","antigravity-film":"oklejka_antigravijnoj_plenkoj","disk-painting":"okras_kolesnykh_diskov",polish:"polirovka",cleaning:"khimchistka"},y=n[e.mainService]||e.mainService,b=e.additionalServices.map(s=>m[s]||s),j={name:`Заявка от ${e.name}`,userName$c:e.name,userPhone$c:e.phone,car_model$c:e.carModel,main_service$c:y,additional_services$c:b.join(","),discount$c:e.discount};fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}).then(s=>{s.ok||s.text().then(A=>{})}).catch(s=>{}).finally(()=>{o.classList.remove("loading"),o.textContent="Отправить заявку",o.disabled=!1}),fetch("/api/requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,phone:e.phone,carModel:e.carModel,mainService:e.mainService,additionalServices:e.additionalServices,discount:e.discount,source:"WEBSITE"})}).then(s=>{s.ok&&typeof ym=="function"&&ym(106816930,"reachGoal","form_success")}).catch(s=>{})}a(),L(),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const n=document.querySelector(this.getAttribute("href"));n&&n.scrollIntoView({behavior:"smooth",block:"start"})})});const N={threshold:.1,rootMargin:"0px 0px -50px 0px"},R=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&(t.target.style.animationPlayState="running")})},N);document.querySelectorAll(".contacts__left, .contacts__right").forEach(e=>{R.observe(e)})});
